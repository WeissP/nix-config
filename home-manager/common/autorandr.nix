{ myEnv, ... }:
let
  fingerprints = {
    desktop = {
      DisplayPort-0 = "00ffffffffffff0060a310201100000011220104b55021783b8cb5af4f43ab260e5054210800714081c081809500a9c0b300d1c0d100f57c70a0d0a02950302035001d4d3100001a000000fd0030a5fefe64010a202020202020000000fc004d464733344335510a20202020000000ff000a20202020202020202020202002c1020328f44990010203041f05403f23097f0783010000e200c0e305c000e6060501626200e30f00006a5e00a0a0a02950302035001d4d3100001a5b9d00a0a0a02950302035001d4d3100001ad4bc00a0a0a02950302035001d4d3100001a98e200a0a0a02950302035001d4d3100001a0000000000000000000000000000001b7012790000030164a2030104ff099f002f801f009f0528000200040043d000056f0d9f002f801f009f05280002000400eaf900056f0d9f002f801f009f05280002000400e62b01056f0d9f002f801f009f05280002000400905801056f0d9f002f801f009f052c00020004000000000000000000000000000000000000002790";
      DisplayPort-1 = "00ffffffffffff00410c0cc2ca5900001a1f0104a53c22783be445a554529e260d5054bfef00d1c0b30095008180814081c001010101565e00a0a0a029503020350055502100001ea073006aa0a029500820350055502100001a000000fc0050484c2032373545310a202020000000fd00304b72721e010a20202020202001b002031ef14b0103051404131f12021190230907078301000065030c001000023a801871382d40582c450055502100001e011d007251d01e206e28550055502100001e8c0ad08a20e02d10103e96005550210000188c0ad090204031200c405500555021000018f03c00d051a0355060883a0055502100001c0000000000000077";
      HDMI-A-0 = "00ffffffffffff00410c0cc2ca5900001a1f0103803c22782ae445a554529e260d5054bfef00d1c0b30095008180814081c001010101565e00a0a0a029503020350055502100001ea073006aa0a029500820350055502100001a000000fc0050484c2032373545310a202020000000fd00304b1e721e000a202020202020013c020327f14b101f051404130312021101230907078301000065030c001000681a00000101304b00023a801871382d40582c450055502100001e8c0ad08a20e02d10103e96005550210000188c0ad090204031200c405500555021000018f03c00d051a0355060883a0055502100001c00000000000000000000000000000000ad";
    };
    mini = {
      DP-1 = "00ffffffffffff001e6d585a590f0000061c0103803c2278ea3135a5554ea1260c5054a54b00714f8180818fb3000101010101010101023a801871382d40582c4500dd0c1100001e000000fd00384b1e530f000a202020202020000000fc0032374d4236350a202020202020000000ff003830364e54545130333932390a00a7";
      HDMI-1 = "00ffffffffffff00410c180990130000241d0103803c22782a2031a5544c9f260e5054bfef00d1c0b30095008180814081c001010101565e00a0a0a029503020350055502100001e000000ff00554b3031393336303035303038000000fd00304c1e721e000a202020202020000000fc0050484c203237324238510a202001ae020329f14b101f051404130312021101230907078301000067030c001000383c681a00000101303e00023a801871382d40582c450055502100001e8c0ad08a20e02d10103e96005550210000188c0ad090204031200c405500555021000018f03c00d051a0355060883a0055502100001c000000000000000000000000000042";
    };
  };
  fingerprint = fingerprints."${myEnv.configSession}";
in
{
  services.autorandr = {
    enable = true;
  };
  programs.autorandr = {
    enable = true;
    hooks = {
      preswitch = myEnv.ifXorg {
        stop_trayer = ''systemctl --user stop trayer'';
      };
      postswitch = myEnv.ifXorg {
        restart_xmobar = "killall xmobar && xmonad --restart";
        start_trayer = ''systemctl --user start trayer'';
      };
    };
    profiles = {
      "default" = {
        inherit fingerprint;
        config =
          if myEnv.configSession == "desktop" then
            {
              DisplayPort-1 = {
                enable = true;
                mode = "3440x1440";
                position = "0x480";
                primary = true;
                rate = "60.00";
              };
              HDMI-A-0 = {
                enable = true;
                mode = "2560x1440";
                position = "3440x0";
                rate = "59.95";
                rotate = "right";
              };
            }
          else if myEnv.configSession == "mini" then
            {
              HDMI-1 = {
                enable = true;
                mode = "2560x1440";
                position = "0x0";
                rate = "59.95";
                primary = true;
                crtc = 0;
              };
              DP-1 = {
                enable = true;
                mode = "1920x1080";
                position = "2560x226";
                crtc = 1;
                primary = false;
                rate = "60.00";
              };
            }
          else
            { };
      };
      exp = {
        inherit fingerprint;
        config = {
          HDMI-1 = {
            enable = true;
            mode = "2560x1440";
            position = "0x0";
            rate = "59.95";
            primary = true;
            crtc = 1;
          };
          DP-1 = {
            enable = true;
            mode = "1920x1080";
            position = "2560x226";
            crtc = 0;
            primary = false;
            rate = "60.00";
          };
        };
      };
    };
  };
}
